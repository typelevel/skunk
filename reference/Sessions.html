<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Sessions · Skunk</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='docs'/>
<link rel="canonical" href="https://github.com/tpolecat/skunkreference/Sessions.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Skunk
</a>
<div class="version-number">
0.2.0
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../tutorial/Index.html" class="page">Tutorial</a>
  <ul>
    <li><a href="../tutorial/Setup.html" class="page">Setup</a></li>
    <li><a href="../tutorial/Query.html" class="page">Queries</a></li>
    <li><a href="../tutorial/Command.html" class="page">Commands</a></li>
    <li><a href="../tutorial/Transactions.html" class="page">Transactions</a></li>
    <li><a href="../tutorial/Channels.html" class="page">Channels</a></li>
    <li><a href="../tutorial/Tracing.html" class="page">Tracing</a></li>
  </ul></li>
  <li><a href="../reference/Index.html" class="page">Reference</a>
  <ul>
    <li><a href="../reference/Sessions.html" class="active page">Sessions</a></li>
    <li><a href="../reference/TwiddleLists.html" class="page">Twiddle Lists</a></li>
    <li><a href="../reference/Encoders.html" class="page">Encoders</a></li>
    <li><a href="../reference/Fragments.html" class="page">Fragments</a></li>
    <li><a href="../reference/Identifiers.html" class="page">Identifiers</a></li>
    <li><a href="../reference/Concurrency.html" class="page">Concurrency</a></li>
    <li><a href="../reference/SchemaTypes.html" class="page">Schema Types</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">Skunk</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Skunk
</a>
<div class="version-number">
0.2.0
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../tutorial/Index.html" class="page">Tutorial</a>
  <ul>
    <li><a href="../tutorial/Setup.html" class="page">Setup</a></li>
    <li><a href="../tutorial/Query.html" class="page">Queries</a></li>
    <li><a href="../tutorial/Command.html" class="page">Commands</a></li>
    <li><a href="../tutorial/Transactions.html" class="page">Transactions</a></li>
    <li><a href="../tutorial/Channels.html" class="page">Channels</a></li>
    <li><a href="../tutorial/Tracing.html" class="page">Tracing</a></li>
  </ul></li>
  <li><a href="../reference/Index.html" class="page">Reference</a>
  <ul>
    <li><a href="../reference/Sessions.html" class="active page">Sessions</a></li>
    <li><a href="../reference/TwiddleLists.html" class="page">Twiddle Lists</a></li>
    <li><a href="../reference/Encoders.html" class="page">Encoders</a></li>
    <li><a href="../reference/Fragments.html" class="page">Fragments</a></li>
    <li><a href="../reference/Identifiers.html" class="page">Identifiers</a></li>
    <li><a href="../reference/Concurrency.html" class="page">Concurrency</a></li>
    <li><a href="../reference/SchemaTypes.html" class="page">Schema Types</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Skunk</a></li>
  <li><a href="../reference/Index.html">Reference</a></li>
  <li>Sessions</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#sessions" name="sessions" class="anchor"><span class="anchor-link"></span></a>Sessions</h1>
<p><code>Session</code> represents a connection to a Postgres database.</p>
<h2><a href="#obtaining-a-session" name="obtaining-a-session" class="anchor"><span class="anchor-link"></span></a>Obtaining a Session</h2>
<p>TBD - talk about pooling, session lifecycle, cleanup, etc.</p>
<h2><a href="#authentication" name="authentication" class="anchor"><span class="anchor-link"></span></a>Authentication</h2>
<p>Skunk currently supports the <strong>trust</strong> (no password necessary) and <strong>password</strong> (<code>md5</code> and <code>scram-sha-256</code> only) authentication methods.</p>
<p>See <a href="https://www.postgresql.org/docs/current/auth-methods.html">§20.3</a> in the Postgres documentation for more information on authentication methods.</p>
<h2><a href="#encryption-with-ssl" name="encryption-with-ssl" class="anchor"><span class="anchor-link"></span></a>Encryption with SSL</h2>
<p>To connect with SSL (disabled by default) provide the <code>ssl</code> named argument when constructing a <code>Session</code> resource.</p>
<pre class="prettyprint"><code class="language-scala">Session.single[IO](
  host     = &quot;localhost&quot;,
  user     = &quot;jimmy&quot;,
  database = &quot;world&quot;,
  password = Some(&quot;banana&quot;),
  debug    = true,
  ssl      = SSL.System, // Use SSL with the system default SSLContext.
)
</code></pre>
<p>Skunk supports all TLS modes provided by fs2.</p>
<table>
  <thead>
    <tr>
      <th>Mode </th>
      <th>Comment </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>SSL.None</code> </td>
      <td>Skunk will not request SSL. <strong>This is the default.</strong> </td>
    </tr>
    <tr>
      <td><code>SSL.Trusted</code> </td>
      <td>Connect via SSL and trust all certificates. Use this if you&rsquo;re running with a self-signed certificate, for instance. </td>
    </tr>
    <tr>
      <td><code>SSL.System</code> </td>
      <td>Connect via SSL and use the system default <code>SSLContext</code> to verify certificates. Use this if you&rsquo;re running with a CA-signed certificate. </td>
    </tr>
    <tr>
      <td><code>SSL.fromSSLContext(…)</code> </td>
      <td>Connect via SSL using an existing <code>SSLContext</code>. </td>
    </tr>
    <tr>
      <td><code>SSL.fromKeyStoreFile(…)</code> </td>
      <td>Connect via SSL using a specified keystore file. </td>
    </tr>
    <tr>
      <td><code>SSL.fromKeyStoreResource(…)</code> </td>
      <td>Connect via SSL using a specified keystore classpath resource. </td>
    </tr>
    <tr>
      <td><code>SSL.fromKeyStore(…)</code> </td>
      <td>Connect via SSL using an existing Keystore. </td>
    </tr>
  </tbody>
</table>
<p>In addition to these options, the <code>SSL</code> values themselves allow the following modifications:</p>
<table>
  <thead>
    <tr>
      <th>Property </th>
      <th>Default </th>
      <th>Comment </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>.withFallback(…)</code> </td>
      <td><code>false</code> </td>
      <td>If true, allow fallback to a non-encrypted connection if SSL is unavailable. </td>
    </tr>
    <tr>
      <td><code>.withTLSParameters(…)</code> </td>
      <td><code>TLSParameters.Default</code> </td>
      <td>Allows for custom <a href="https://static.javadoc.io/co.fs2/fs2-io_2.12/3.0.4/fs2/io/tls/TLSParameters.html" title="fs2.io.tls.TLSParameters"><code>TLSParameters</code></a>.</td>
    </tr>
  </tbody>
</table>
<h2><a href="#session-parameters" name="session-parameters" class="anchor"><span class="anchor-link"></span></a>Session Parameters</h2>
<p>Session parameters affect data serialization and are specified by Skunk during startup negotiation. Changing them via a <code>SET</code> command will result in undefined behavior. The following session parameters are set by default:</p>
<table>
  <thead>
    <tr>
      <th>Parameter </th>
      <th>Value </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>client_min_messages</code> </td>
      <td><code>WARNING</code> </td>
    </tr>
    <tr>
      <td><code>DateStyle</code> </td>
      <td><code>ISO, MDY</code> </td>
    </tr>
    <tr>
      <td><code>IntervalStyle</code> </td>
      <td><code>iso_8601</code> </td>
    </tr>
    <tr>
      <td><code>client_encoding</code> </td>
      <td><code>UTF8</code> </td>
    </tr>
  </tbody>
</table>
<p>It is possible to modify default session parameters via the parameters session property, which is unsupported in general but may be necessary when using nonstandard Postgres variants. Amazon Redshift, for example, does not support the <code>IntervalStyle</code> parameter, and this will cause startup negotiation to fail. A workaround is demonstrated below.</p>
<pre class="prettyprint"><code class="language-scala">Session.single[IO](
  host       = &quot;localhost&quot;,
  user       = &quot;jimmy&quot;,
  database   = &quot;world&quot;,
  password   = Some(&quot;banana&quot;),
  port       = 5439,
  parameters = Session.DefaultConnectionParameters - &quot;IntervalStyle&quot;
)
</code></pre>
<h2><a href="#error-conditions" name="error-conditions" class="anchor"><span class="anchor-link"></span></a>Error Conditions</h2>
<p>A <code>Session</code> is ultimately a TCP Socket, and as such a number of error conditions can arise. These conditions immediately invalidate the session and raise exceptions in your effect type <code>F</code>, with the expectation that the operation will fail, or will perhaps be retried with a new session.</p>
<table>
  <thead>
    <tr>
      <th>Condition </th>
      <th>Exception </th>
      <th>Meaning </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Connect&nbsp;Timeout </td>
      <td>TBD </td>
      <td>TBD - The connect timeout expired before a connection can be established with the Postgres server. </td>
    </tr>
    <tr>
      <td>Protocol&nbsp;Timeout </td>
      <td>TBD </td>
      <td>TBD - The protocol timeout expired before receiving an expected response from the Postgres server. </td>
    </tr>
    <tr>
      <td>Disconnection </td>
      <td><code>EofException</code> </td>
      <td>The underlying socket has been closed. </td>
    </tr>
  </tbody>
</table>
<p>Note that if you wish to <strong>limit statement execution time</strong>, it&rsquo;s best to use the <code>statement_timeout</code> session parameter (settable via SQL or via <code>parameters</code> above), which will raise a server-side exception on expiration and will <em>not</em> invalidate the session.</p>
<script type="text/javascript" src="../js/link_fix.js"></script>

<div class="source-github">
The source code for this page can be found <a id="source-link" href="https://github.com/tpolecat/skunk/tree/v0.2.0/modules/docs/target/mdoc/reference/Sessions.md">here</a>.
</div>

<script type="text/javascript">jQuery(function(){sourceUrlFix('https://github.com/tpolecat/skunk/tree/v0.2.0/modules/docs/target/mdoc/reference/Sessions.md')});</script>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../reference/TwiddleLists.html">Twiddle Lists</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../reference/Sessions.html#sessions" class="header">Sessions</a>
  <ul>
    <li><a href="../reference/Sessions.html#obtaining-a-session" class="header">Obtaining a Session</a></li>
    <li><a href="../reference/Sessions.html#authentication" class="header">Authentication</a></li>
    <li><a href="../reference/Sessions.html#encryption-with-ssl" class="header">Encryption with SSL</a></li>
    <li><a href="../reference/Sessions.html#session-parameters" class="header">Session Parameters</a></li>
    <li><a href="../reference/Sessions.html#error-conditions" class="header">Error Conditions</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2021</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '0.2.0', 'https://github.com/tpolecat/skunk')});</script>


</html>
